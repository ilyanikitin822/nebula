<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è ‚Ä¢ NeoControl</title>
    <style>
        :root {
            --primary: #6366f1;
            --dark: #0f172a;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: var(--dark);
            color: #fff;
            min-height: 100vh;
        }
        
        .navbar {
            background: rgba(15, 23, 42, 0.9);
            padding: 15px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .container {
            max-width: 1000px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .logs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .logs-table {
            width: 100%;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .log-row {
            display: grid;
            grid-template-columns: 150px 120px 1fr;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            align-items: center;
        }
        
        .log-row.header {
            background: rgba(99, 102, 241, 0.2);
            font-weight: bold;
        }
        
        .log-type {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            text-align: center;
        }
        
        .type-geolocation { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .type-image { background: rgba(99, 102, 241, 0.2); color: #6366f1; }
        .type-login { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .type-system { background: rgba(148, 163, 184, 0.2); color: #94a3b8; }
        
        .btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
        }
        
        .empty-logs {
            text-align: center;
            padding: 40px;
            color: #94a3b8;
        }
        
        .export-btn {
            background: linear-gradient(135deg, #10b981, #059669);
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div>
            <h2>üìä –ò—Å—Ç–æ—Ä–∏—è –º–æ–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π</h2>
            <p style="color: #94a3b8; font-size: 14px;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {{ username }} ‚Ä¢ ID: {{ user_id }}</p>
        </div>
        <div>
            <a href="/dashboard" class="btn">–ù–∞–∑–∞–¥ –∫ –ø–∞–Ω–µ–ª–∏</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="logs-header">
            <h3>–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: {{ logs|length }}</h3>
            <button class="btn export-btn" onclick="exportLogs()">üì• –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤</button>
        </div>
        
        {% if logs %}
        <div class="logs-table">
            <div class="log-row header">
                <div>–í—Ä–µ–º—è</div>
                <div>–¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è</div>
                <div>–î–µ—Ç–∞–ª–∏</div>
            </div>
            
            {% for log in logs %}
            <div class="log-row">
                <div>{{ log.timestamp }}</div>
                <div>
                    <span class="log-type type-{{ log.action_type }}">
                        {% if log.action_type == 'geolocation' %}üìç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
                        {% elif log.action_type == 'image_capture' %}üì∏ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        {% elif log.action_type == 'login' %}üîê –í—Ö–æ–¥
                        {% elif log.action_type == 'logout' %}üö™ –í—ã—Ö–æ–¥
                        {% else %}‚öôÔ∏è {{ log.action_type }}
                        {% endif %}
                    </span>
                </div>
                <div>{{ log.details }}</div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-logs">
            <h3>üì≠ –õ–æ–≥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
            <p style="margin-top: 10px;">–í–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã</p>
            <p style="font-size: 12px; margin-top: 20px;">
                –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å —Å–Ω–∏–º–æ–∫ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥"
            </p>
        </div>
        {% endif %}
        
        <div style="margin-top: 30px; text-align: center;">
            <p style="color: #94a3b8; font-size: 12px;">
                NeoControl v3.0 ‚Ä¢ –õ–æ–≥–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è 90 –¥–Ω–µ–π ‚Ä¢ –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∑–∞–ø–∏—Å–∞–Ω—ã
            </p>
        </div>
    </div>

    <script>
        function exportLogs() {
            // –°–æ–∑–¥–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
            let logContent = "NeoControl - –ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π\n";
            logContent += "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {{ username }}\n";
            logContent += "ID: {{ user_id }}\n";
            logContent += "–î–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: " + new Date().toLocaleString('ru-RU') + "\n\n";
            
            {% for log in logs %}
            logContent += "{{ log.timestamp }} | {{ log.action_type }} | {{ log.details }}\n";
            {% endfor %}
            
            // –°–æ–∑–¥–∞–µ–º Blob –∏ —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
            const blob = new Blob([logContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `neocontrol_logs_{{ username }}_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('–õ–æ–≥–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª');
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            window.location.reload();
        }, 30000);
    </script>
</body>
</html>